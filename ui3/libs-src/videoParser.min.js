function _typeof(e){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(c){return typeof c}:function(c){return c&&"function"==typeof Symbol&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},_typeof(e)}function _classCallCheck(e,c){if(!(e instanceof c))throw new TypeError("Cannot call a class as a function");}
function _defineProperties(e,c){for(var g=0;g<c.length;g++){var f=c[g];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(e,_toPropertyKey(f.key),f)}}function _createClass(e,c,g){return c&&_defineProperties(e.prototype,c),g&&_defineProperties(e,g),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}
function _toPrimitive(e,c){if("object"!=_typeof(e)||!e)return e;var g=e[Symbol.toPrimitive];if(void 0!==g){e=g.call(e,c||"default");if("object"!=_typeof(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.");}return("string"===c?String:Number)(e)}
var UI3BitReader=function(){function e(c){_classCallCheck(this,e);this.bytes=this.removeEmulationPreventionBytes(c);this.bitOffset=this.byteOffset=0}return _createClass(e,[{key:"removeEmulationPreventionBytes",value:function(c){for(var g=[],f=0;f<c.length;f++)f>1&&c[f]===3&&c[f-1]===0&&c[f-2]===0||g.push(c[f]);return new Uint8Array(g)}},{key:"readBit",value:function(){if(this.byteOffset>=this.bytes.length)throw Error("Out of range");var c=this.bytes[this.byteOffset]>>7-this.bitOffset&1;this.bitOffset++;
this.bitOffset===8&&(this.bitOffset=0,this.byteOffset++);return c}},{key:"readBits",value:function(c){for(var g=0,f=0;f<c;f++)g=g<<1|this.readBit();return g}},{key:"readUE",value:function(){for(var c=0;this.readBit()===0;)c++;return(1<<c)-1+this.readBits(c)}},{key:"readSE",value:function(){var c=this.readUE();return(c&1?1:-1)*Math.ceil(c/2)}},{key:"bitsRemaining",value:function(){return this.bytes.length*8-(this.byteOffset*8+this.bitOffset)}},{key:"skipBits",value:function(c){this.byteOffset+=Math.floor(c/
8);this.bitOffset+=c%8}}])}(),UI3_VideoParser=new function(){var e=this;this.getNalTypeName=function(c,g){if(g)switch(c){case 0:return"TRAIL_N";case 1:return"TRAIL_R";case 19:return"IDR_W_RADL";case 20:return"IDR_N_LP";case 21:return"CRA";case 32:return"VPS";case 33:return"SPS";case 34:return"PPS";case 35:return"AUD";case 39:return"SEI";case 40:return"SEI2"}else switch(c){case 1:return"NDR";case 5:return"IDR";case 6:return"SEI";case 7:return"SPS";case 8:return"PPS";case 9:return"AUD"}};this.parseNALUnits=
function(c,g){var f=[],a=0;if(c[0]===0&&c[1]===0&&(c[2]===1||c[2]===0&&c[3]===1))for(;a<c.length;){for(var b=-1;a<c.length-3;a++)if(c[a]===0&&c[a+1]===0&&(c[a+2]===1||c[a+2]===0&&c[a+3]===1)){b=a;break}if(b<0)break;b+=c[b+2]===1?3:4;a=c.length;for(var d=b;d<c.length-3;d++)if(c[d]===0&&c[d+1]===0&&(c[d+2]===1||c[d+2]===0&&c[d+3]===1)){a=d;break}b=c.slice(b,a);b.length>0&&(d=b[0]&31,b={type:d,type_name:e.getNalTypeName(d,g),data:b},f.push(b))}else for(;a+4<=c.length;){b=c[a]<<24|c[a+1]<<16|c[a+2]<<
8|c[a+3];a+=4;if(b<=0||a+b>c.length)break;d=c.slice(a,a+b);var h=f,k=d[0];h.push.call(h,{type:g?k>>1&63:k&31,data:d});a+=b}for(c=0;c<f.length;c++)a=f[c],g||(a.type===7?a.sps=UI3_H264Parser.parseSPS(a.data):a.type===8&&(a.pps=UI3_H264Parser.parsePPS(a.data)));return f}},UI3_H264Parser=new function(){function e(a){var b={};b.cpb_cnt_minus1=a.readUE();b.bit_rate_scale=a.readBits(4);b.cpb_size_scale=a.readBits(4);b.cpb=[];for(var d=0;d<=b.cpb_cnt_minus1;d++){var h={bit_rate_value_minus1:a.readUE(),cpb_size_value_minus1:a.readUE(),
cbr_flag:a.readBit()};b.cpb.push(h)}b.initial_cpb_removal_delay_length_minus1=a.readBits(5);b.cpb_removal_delay_length_minus1=a.readBits(5);b.dpb_output_delay_length_minus1=a.readBits(5);b.time_offset_length=a.readBits(5);return b}function c(a){var b={};try{if(a.bitsRemaining()<=0)return b;b.aspect_ratio_info_present_flag=a.readBit();b.aspect_ratio_info_present_flag&&(b.aspect_ratio_idc=a.readBits(8),b.aspect_ratio_idc===255&&(b.sar_width=a.readBits(16),b.sar_height=a.readBits(16)));if(a.bitsRemaining()<=
0)return b;b.overscan_info_present_flag=a.readBit();b.overscan_info_present_flag&&(b.overscan_appropriate_flag=a.readBit());if(a.bitsRemaining()<=0)return b;b.video_signal_type_present_flag=a.readBit();b.video_signal_type_present_flag&&(b.video_format=a.readBits(3),b.video_full_range_flag=a.readBit(),b.colour_description_present_flag=a.readBit(),b.colour_description_present_flag&&(b.colour_primaries=a.readBits(8),b.transfer_characteristics=a.readBits(8),b.matrix_coefficients=a.readBits(8)));if(a.bitsRemaining()<=
0)return b;b.chroma_loc_info_present_flag=a.readBit();b.chroma_loc_info_present_flag&&(b.chroma_sample_loc_type_top_field=a.readUE(),b.chroma_sample_loc_type_bottom_field=a.readUE());if(a.bitsRemaining()<=0)return b;b.timing_info_present_flag=a.readBit();b.timing_info_present_flag&&(b.num_units_in_tick=a.readBits(32),b.time_scale=a.readBits(32),b.fixed_frame_rate_flag=a.readBit(),b.num_units_in_tick&&b.time_scale&&(b.derived_fps=b.time_scale/(2*b.num_units_in_tick)));if(a.bitsRemaining()<=0)return b;
b.nal_hrd_parameters_present_flag=a.readBit();b.nal_hrd_parameters_present_flag&&(b.nal_hrd=e(a));if(a.bitsRemaining()<=0)return b;b.vcl_hrd_parameters_present_flag=a.readBit();b.vcl_hrd_parameters_present_flag&&(b.vcl_hrd=e(a));if(b.nal_hrd_parameters_present_flag||b.vcl_hrd_parameters_present_flag)b.low_delay_hrd_flag=a.readBit();if(a.bitsRemaining()<=0)return b;b.pic_struct_present_flag=a.readBit();if(a.bitsRemaining()<=0)return b;b.bitstream_restriction_flag=a.readBit();b.bitstream_restriction_flag&&
(b.motion_vectors_over_pic_boundaries_flag=a.readBit(),b.max_bytes_per_pic_denom=a.readUE(),b.max_bits_per_mb_denom=a.readUE(),b.log2_max_mv_length_horizontal=a.readUE(),b.log2_max_mv_length_vertical=a.readUE(),b.max_num_reorder_frames=a.readUE(),b.max_dec_frame_buffering=a.readUE());if(b.aspect_ratio_info_present_flag&&b.aspect_ratio_idc!==255){var d={1:[1,1],2:[12,11],3:[10,11],4:[16,11],5:[40,33],6:[24,11],7:[20,11],8:[32,11],9:[80,33],10:[18,11],11:[15,11],12:[64,33],13:[160,99],14:[4,3],15:[3,
2],16:[2,1]}[b.aspect_ratio_idc];d&&(b.sar_width=d[0],b.sar_height=d[1])}}catch(h){console.warn("Error parsing VUI:",h)}return b}function g(a){switch(a){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High 10";case 122:return"High 4:2:2";case 244:return"High 4:4:4 Predictive";case 44:return"CAVLC 4:4:4 Intra";case 83:return"Scalable Baseline";case 86:return"Scalable High";case 118:return"Multiview High";case 128:return"Stereo High";default:return"Unknown ("+
a+")"}}function f(a){switch(a){case 0:return"Monochrome (no chroma)";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown ("+a+")"}}this.parseSPS=function(a){var b=new UI3BitReader(a);b.skipBits(8);a={h264:!0};try{a.profile_idc=b.readBits(8);a.constraint_set_flags=b.readBits(8);a.level_idc=b.readBits(8);a.profileName=g(a.profile_idc);var d=a.level_idc;a.levelName=Math.floor(d/10)+"."+d%10;var h=a.profile_idc;d=[];h&128&&d.push("0");h&64&&d.push("1");h&32&&d.push("2");
h&16&&d.push("3");h&8&&d.push("4");h&4&&d.push("5");var k=d.length?d.join(","):"none";a.constraints=k;a.summary="Profile: "+a.profileName+", Level: "+a.levelName+(a.constraint_set_flags===0?"":", Constraints: "+a.constraints);a.seq_parameter_set_id=b.readUE();(new Set([100,110,122,244,44,83,86,118,128,138,139,134])).has(a.profile_idc)?(a.chroma_format_idc=b.readUE(),a.chroma_format_idc===3&&(a.separate_colour_plane_flag=b.readBit()),a.bit_depth_luma_minus8=b.readUE(),a.bit_depth_chroma_minus8=b.readUE(),
a.qpprime_y_zero_transform_bypass_flag=b.readBit(),a.seq_scaling_matrix_present_flag=b.readBit()):a.chroma_format_idc=1;a.chroma=f(a.chroma_format_idc);a.log2_max_frame_num_minus4=b.readUE();a.pic_order_cnt_type=b.readUE();if(a.pic_order_cnt_type===0)a.log2_max_pic_order_cnt_lsb_minus4=b.readUE();else if(a.pic_order_cnt_type===1){a.delta_pic_order_always_zero_flag=b.readBit();a.offset_for_non_ref_pic=b.readSE();a.offset_for_top_to_bottom_field=b.readSE();var m=b.readUE();a.offset_for_ref_frame=[];
for(k=0;k<m;k++)a.offset_for_ref_frame.push(b.readSE())}a.max_num_ref_frames=b.readUE();a.gaps_in_frame_num_value_allowed_flag=b.readBit();a.pic_width_in_mbs_minus1=b.readUE();a.pic_height_in_map_units_minus1=b.readUE();a.frame_mbs_only_flag=b.readBit();a.frame_mbs_only_flag||(a.mb_adaptive_frame_field_flag=b.readBit());a.direct_8x8_inference_flag=b.readBit();a.frame_cropping_flag=b.readBit();a.frame_cropping_flag&&(a.frame_crop_left_offset=b.readUE(),a.frame_crop_right_offset=b.readUE(),a.frame_crop_top_offset=
b.readUE(),a.frame_crop_bottom_offset=b.readUE());a.vui_parameters_present_flag=b.readBit();a.vui_parameters_present_flag&&(a.vui=c(b));var n=(a.pic_width_in_mbs_minus1+1)*16,p=(a.frame_mbs_only_flag?1:2)*(a.pic_height_in_map_units_minus1+1)*16;if(a.frame_cropping_flag){var l=a.chroma_format_idc;m=l===0?1:l===1||l===2?2:1;var q=l===0?2-a.frame_mbs_only_flag:(l===1?2:1)*(2-a.frame_mbs_only_flag),r=a.frame_crop_top_offset*q,t=a.frame_crop_bottom_offset*q;n-=a.frame_crop_left_offset*m+a.frame_crop_right_offset*
m;p-=r+t}a.width=n;a.height=p;a.vui&&a.vui.sar_width&&a.vui.sar_height&&(a.sample_aspect_ratio=a.vui.sar_width/a.vui.sar_height,a.display_width=Math.round(n*a.sample_aspect_ratio),a.display_height=p);a.vui&&typeof a.vui.derived_fps==="number"&&(a.fps=a.vui.derived_fps)}catch(u){console.warn("Error parsing SPS:",u)}return a};this.parsePPS=function(a){var b=new UI3BitReader(a);b.skipBits(8);var d={h264:!0};try{d.pic_parameter_set_id=b.readUE();d.seq_parameter_set_id=b.readUE();d.entropy_coding_mode_flag=
b.readBit();d.bottom_field_pic_order_in_frame_present_flag=b.readBit();var h=b.readUE();d.num_slice_groups_minus1=h;h>0&&(d.slice_group_map_type=b.readUE());d.num_ref_idx_l0_default_active_minus1=b.readUE();d.num_ref_idx_l1_default_active_minus1=b.readUE();d.weighted_pred_flag=b.readBit();d.weighted_bipred_idc=b.readBits(2);d.pic_init_qp_minus26=b.readSE();d.pic_init_qs_minus26=b.readSE();d.chroma_qp_index_offset=b.readSE();d.deblocking_filter_control_present_flag=b.readBit();d.constrained_intra_pred_flag=
b.readBit();d.redundant_pic_cnt_present_flag=b.readBit();if(b.bitsRemaining()<=0)return d;b.byteOffset<a.length&&(d.transform_8x8_mode_flag=b.readBit(),d.pic_scaling_matrix_present_flag=b.readBit())}catch(k){console.warn("Error parsing PPS:",k)}return d}};
